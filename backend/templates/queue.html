{% extends "base.html" %}

{% block title %}Queue - Seedarr v2.0{% endblock %}
{% block page_title %}Queue{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Queue Header with Controls -->
    <div class="dashboard-header">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="dashboard-title">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                    </svg>
                    Active Queue
                </h1>
                <p class="dashboard-subtitle">Monitor and manage jobs in progress</p>
            </div>
            <div class="flex gap-2">
                <button
                    class="btn-primary"
                    hx-post="/api/dashboard/process"
                    hx-target="#process-result"
                    hx-swap="innerHTML"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Process All
                </button>
                <button
                    class="btn-secondary"
                    onclick="window.location.reload()"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- Queue Stats (Dynamic from database) -->
    {% if active_jobs or error %}
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Processing</div>
            <div class="stat-value">{{ total_count|default(active_jobs|length) }}</div>
            <div class="stat-change active">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                </svg>
                Active now
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Total Size</div>
            <div class="stat-value">
                {% set total_size = namespace(value=0) %}
                {% for job in active_jobs %}
                    {% if job.file_size %}
                        {% set total_size.value = total_size.value + job.file_size %}
                    {% endif %}
                {% endfor %}
                {% if total_size.value > 1073741824 %}
                    {{ "%.1f"|format(total_size.value / 1073741824) }} GB
                {% elif total_size.value > 1048576 %}
                    {{ "%.1f"|format(total_size.value / 1048576) }} MB
                {% else %}
                    {{ "%.1f"|format(total_size.value / 1024) }} KB
                {% endif %}
            </div>
            <div class="stat-change">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 12v3c0 1.657 3.134 3 7 3s7-1.343 7-3v-3c0 1.657-3.134 3-7 3s-7-1.343-7-3z"></path>
                    <path d="M3 7v3c0 1.657 3.134 3 7 3s7-1.343 7-3V7c0 1.657-3.134 3-7 3S3 8.657 3 7z"></path>
                    <path d="M17 5c0 1.657-3.134 3-7 3S3 6.657 3 5s3.134-3 7-3 7 1.343 7 3z"></path>
                </svg>
                All jobs
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Process Result Message -->
    <div id="process-result" class="mb-4"></div>

    <!-- Queue Content with Auto-Refresh -->
    {% include "components/queue_content.html" %}

<style>
    /* Refresh Indicator */
    .refresh-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Stage Badges */
    .stage-badge {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--border-primary);
    }

    .stage-scan {
        background: rgba(6, 182, 212, 0.1);
        border-color: rgba(6, 182, 212, 0.3);
        color: #06b6d4;
    }

    .stage-analyze {
        background: rgba(14, 165, 233, 0.1);
        border-color: rgba(14, 165, 233, 0.3);
        color: #0ea5e9;
    }

    .stage-rename {
        background: rgba(59, 130, 246, 0.1);
        border-color: rgba(59, 130, 246, 0.3);
        color: #3b82f6;
    }

    .stage-metadata {
        background: rgba(139, 92, 246, 0.1);
        border-color: rgba(139, 92, 246, 0.3);
        color: #8b5cf6;
    }

    .stage-upload {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.3);
        color: #10b981;
    }

    /* Priority Badges */
    .priority-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .priority-high {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .priority-normal {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .priority-low {
        background: rgba(148, 163, 184, 0.1);
        color: #94a3b8;
        border: 1px solid rgba(148, 163, 184, 0.3);
    }

    /* Button Icons */
    .btn-icon {
        padding: 0.5rem;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        border-radius: 0.375rem;
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-icon:hover {
        background: var(--bg-secondary);
        border-color: var(--accent-primary);
        color: var(--accent-primary);
    }

    .btn-icon.btn-process:hover {
        border-color: #10b981;
        color: #10b981;
    }

    .btn-icon.btn-delete:hover {
        border-color: #ef4444;
        color: #ef4444;
    }

    /* Status badges */
    .status-badge.pending {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid rgba(245, 158, 11, 0.3);
        color: #f59e0b;
    }

    .connection-dot.waiting {
        background: #f59e0b;
        animation: pulse 2s infinite;
    }

    /* Select Field */
    .select-field {
        padding: 0.5rem 0.75rem;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        border-radius: 0.375rem;
        color: var(--text-primary);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .select-field:hover {
        border-color: var(--accent-primary);
    }

    .select-field:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px var(--shadow-glow);
    }

    /* Progress Container */
    .progress-container {
        min-width: 150px;
    }

    /* Spacing utilities */
    .flex {
        display: flex;
    }

    .items-center {
        align-items: center;
    }

    .justify-between {
        justify-content: space-between;
    }

    .gap-2 {
        gap: 0.5rem;
    }

    /* Stat change indicators */
    .stat-change.active {
        color: var(--accent-primary);
    }
</style>
{% endblock %}
